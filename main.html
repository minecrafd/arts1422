<!--  玫瑰图上色 : https://zhuanlan.zhihu.com/p/121024511 -->
<!DOCTYPE html>
<head>


<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<body style = " background:		#001d22">
<!-- slider -->
<input  type="range" name="mySlider" id="mySlider" min="0" max="5" step="1" value="0" 
        style="position:absolute;top:1400px;left:916px;width:600px;-webkit-appearance:none;background:-webkit-linear-gradient(#38E0E6,#38E0E6);border-radius:10px">

<!-- Create a div where the graph will take place -->

<div id="my_dataviz2" style="position:absolute;height:500px;top:850px;left:900px"></div>

<div id="my_dataviz1" style="position:absolute;top:1600px;height:700px;left:900px"></div>

<div id="my_dataviz3" style="position:absolute;left:1600px;top:1600px;width:2000px;height:700px"></div>
<div id="my_dataviz4" style="position:absolute;left:3700px;height:500px;top:300px"></div>
<div id="my_dataviz5" style="position:absolute;left:3700px;top:1050px;width:600px;height:500px"></div>
<div id="my_dataviz6" style="position:absolute;left:3700px;top:1800px;width:600px;height:500px"></div>
<div id="my_dataviz7" style="position:absolute;left:1600px;top:300px;width:2000px;height:1050px"></div>
<div id="my_dataviz8" style="position:absolute;left:900px;top:300px;width:600px;height:300px"></div>
<div>
  <svg id="my_dataviz9" style="position:absolute;left:3700px;top:1800px;width:700px;height:200px;"></svg>
</div>


<div id="label_bubble" style="position:absolute;top:700px;height:100px;width:600px;left:900px"></div>
<div id="label_circular" style="position:absolute;top:1450px;height:100px;width:600px;left:900px"></div>
<div id="label_stream" style="position:absolute;top:1450px;height:100px;width:2000px;left:1600px"></div>
<div id="label_line" style="position:absolute;top:150px;height:100px;width:600px;left:3700px"></div>
<div id="label_relation" style="position:absolute;top:900px;height:100px;width:600px;left:3700px"></div>
<div id="label_kuosan" style="position:absolute;top:1650px;height:100px;width:600px;left:3700px"></div>
<div id="label_main" style="position:absolute;top:150px;height:100px;width:2000px;left:1600px"></div>
<div id="label_bv" style="position:absolute;top:150px;height:100px;width:600px;left:900px"></div> 

<!-- bv号接口 -->
<input type="text" name="BV" id="BV" value="请输入BV号" theme = "#38E0E6" style="position:absolute;top:450px;left:1000px;width:300px;height:40px;font-size:20px">
<!-- 按钮 -->
<button type="button"  style="position:absolute;top:454px;left:1350px;width:70px;height:40px;font-size:20px">确 认</button>
<!-- slider_redu -->
<input type="range" name="REDU" id="REDU" min="0" max="5" step="1" value="0" style="position:absolute;top:2250px;left:3700px;width:600px;-webkit-appearance:none;background:-webkit-linear-gradient(#38E0E6,#38E0E6);border-radius:10px">
<div id="zong" style="position:absolute;left:1800px;top:1200px;width:600px;height:100px"></div>
<div id="san" style="position:absolute;left:2850px;top:1200px;width:600px;height:100px"></div>
<div id="label_zong" style="position:absolute;top:1000px;height:100px;width:600px;left:1780px"></div> 
<div id="label_san" style="position:absolute;top:1000px;height:100px;width:600px;left:2800px"></div> 
<div id="tuijian" style="position:absolute;top:300px;height:100px;width:1000px;left:3710px" href = "https://www.bilibili.com/video/BV12L411a7Bo/"></div>


<script>

  const dot = 0
  // set the dimensions and margins of the graph
  const margin = {top: 100, right: 50, bottom: 50, left: 50},
      width = 1000 - margin.left - margin.right,
      height = 700 - margin.top - margin.bottom,
      innerRadius = 90,
      outerRadius = Math.min(width, height) / 2;   // the outerRadius goes from the middle of the SVG area to the border

  // append the svg object
  const svg1 = d3.select("#my_dataviz1")
    .style("background-color", "#003644")
    .style("border", "solid")
    .style("border-width", "10px")
    .style("border-color", "#003644")
    .style("border-radius", "10px")
    .style("padding", "5px")
    .append("svg")
      .attr("width", width-300)
      .attr("height", height + margin.top + margin.bottom)
      
    .append("g")
      .attr("transform", `translate(${(width-300)/2}, ${(height + margin.top + margin.bottom)/2})`);
  // append the svg object to the body of the page
  const svg2 = d3.select("#my_dataviz2")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",  width-300)
        .attr("height", height + margin.top + margin.bottom-200)
        
  const svg3 = d3.select("#my_dataviz3")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width", "2000px")
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              `translate(${margin.left}, ${margin.top})`);
   
  const svg6 = d3.select("#my_dataviz6")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width", width + margin.left + margin.right-400)
        .attr("height", height + margin.top + margin.bottom-200)
      .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);
    
  const svg7 = d3.select("#my_dataviz7")
      .style("background-color", "black")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "black")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width", "2000px")
        .attr("height", height + margin.top + margin.bottom+200)
      .append("g")
        .attr("transform",
              `translate(${margin.left}, ${margin.top})`);

  const svg8 = d3.select("#my_dataviz8")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",  width-300)
        .attr("height", height + margin.top + margin.bottom-200)
  
  const svg9 = d3.select("#zong")
        .style("background-color", "black")
        .style("border", "solid")
        .style("border-width", "10px")
        .style("border-color", "black")
        .style("border-radius", "30px")
        .style("padding", "5px")
        .append("svg")
          .attr("width",  width-300)
          .attr("height", height + margin.top + margin.bottom-200)
  d3.csv("./datasum.csv").then(function(data){
    svg9
        .append("text")
        .data(data)
        .text(function(d){return d.sum})
        .style("font-size","50px") 
        .style("fill","white")
        .style("stroke","white")
        .attr("transform","translate("+190+","+50+")")
  })
  const svg10 = d3.select("#san")
        .style("background-color", "black")
        .style("border", "solid")
        .style("border-width", "10px")
        .style("border-color", "black")
        .style("border-radius", "30px")
        .style("padding", "5px")
        .append("svg")
          .attr("width",  width-300)
          .attr("height", height + margin.top + margin.bottom-200)
  d3.csv("./datasum.csv").then(function(data){
    svg10
        .append("text")
        .data(data)
        .text(function(d){return d.recent})
        .style("font-size","50px") 
        .style("fill","white")
        .style("stroke","white")
        .attr("transform","translate("+190+","+50+")")
  })
  const svg11 = d3.select("#tuijian")
  .style("background-color", "none")
  .append("svg")
    .attr("width",  1000)
    .attr("height", height + margin.top + margin.bottom-200)
  d3.csv("./greatest.csv").then(function(data){
    const BV = function(event,d){
      svg11.select("text").attr("opacity",0)
      svg11
      .append("text")
      .attr("class","bv")
      .text( "BV号：" + d.bvid)
      .style("font-size","20px") 
      .style("fill","white")
      .style("stroke","white")
      .attr("transform","translate("+0+","+50+")")
      .on("click",Link)
    }
    const Link = function(event,d){
      svg11.select("text").select("bv")
      .append('a').data(data).enter()
            .attr("href","https://www.bilibili.com/video/BV12L411a7Bo/")
    }
    
    svg11
      .append("text")
      .data(data)
      .text(function(d){return "拐点处播放量最高视频："  + d.part})
      .style("font-size","20px") 
      .style("fill","white")
      .style("stroke","white")
      .attr("transform","translate("+0+","+50+")")
      .on("click",BV)

      
  
  })
  // 气泡图
  d3.csv("./video.csv").then( function(dataset) {

    // Filter a bit the data
    //data = dataset.filter(function(d){ return d.count>2 })
    data = dataset.filter(function(d){return d.label == 0})
    // Color palette for continents?
    const color = d3.scaleOrdinal()
      .domain([0,1,2,3,4,5])
      .range(["#00F0FF"	,"#00787F","#00A1AB","#00BAC5","#AEFFA1","#FFE974"]);

    // Size scale for countries
    const size = d3.scaleLinear()
      .domain([0, 200])
      .range([15,150])  // circle will be between 7 and 55 px wide


    
    d3.select("#my_dataviz7").select("svg").style("opacity",0)
    d3.select("#my_dataviz4").select("svg").style("opacity",0)
    d3.select("#my_dataviz3").select("svg").style("opacity",0)
    d3.select("#my_dataviz5").select("svg").style("opacity",0)
    d3.select("#my_dataviz6").select("svg").style("opacity",0)
    d3.select("#my_dataviz9").style("opacity",0)
    d3.select("#REDU").style("opacity",0)
    d3.select("#zong").select("svg").style("opacity",0)
    d3.select("#san").select("svg").style("opacity",0)
    d3.select("#label_zong").style("opacity",0)
    d3.select("#label_san").style("opacity",0)
    d3.select("#tuijian").select("svg").style("opacity",0)
    // create a tooltip
    const TooltipMain = d3.select("#my_dataviz7")
        .append("div")
        .style("opacity", 0)
        .attr("class", "tooltip")
    var mousemoveMain = function(event,d) {
      d3.select("#my_dataviz7").select("svg").style("opacity",1)
      d3.select("#my_dataviz4").select("svg").style("opacity",1)
      d3.select("#my_dataviz3").select("svg").style("opacity",1)
      d3.select("#my_dataviz5").select("svg").style("opacity",1)
      d3.select("#my_dataviz9").style("opacity",1)
      d3.select("#my_dataviz6").select("svg").style("opacity",1)
      d3.select("#REDU").style("opacity",1)
      d3.select("#zong").select("svg").style("opacity",1)
      d3.select("#san").select("svg").style("opacity",1)
      d3.select("#label_zong").style("opacity",1)
      d3.select("#label_san").style("opacity",1)
      d3.select("#tuijian").select("svg").style("opacity",1)
      TooltipMain
            .style("opacity", 1)
            .html("所选梗词：" + d.content)
            .style("font-size","40px")
            .style("color","white")
            .style("position","absolute")
            .style("left", 0 + "px")
            .style("top", 0 + "px")
      d3.select("#my_dataviz7").select("svg").selectAll("g").selectAll("circle")
          .style("opacity",.5)
      svg7.select('.' + d.content)
          .style("opacity",1)
          .style("stroke", "white")
    }
    
      
    

    const Tooltip = d3.select("#my_dataviz2")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "#20B2AA")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "10px")
      .style("padding", "5px")

    // Three function that change the tooltip when user hover / move / leave a cell
    const mouseover = function(event, d) {
      Tooltip
        .style("opacity", 1)
      svg2.selectAll("circle" ).style("opacity", .2)
      d3.select(this)
        .style("stroke", "white")
        .style("stroke-width", 1.5)
        .style("opacity", 1)
    }
    const mousemove = function(event, d) {
      Tooltip
        .style("opacity", 1)
        .html(d.content)
        .style("font-size","30px")
        .style("color","white")
        .style("position","absolute")
        .style("left", (event.x-850) + "px")
        .style("top", (event.y-900) + "px")
    }
    const mouseleave = function(event, d) {
      Tooltip
        .style("opacity", 0)
      d3.select(this)
        .style("stroke", "none")
        .style("opacity", 1)
      svg2.selectAll("circle").style("opacity", 1).style("stroke", "none")
      
    }

    // Initialize the circle: all located at the center of the svg area
    const node = svg2.append("g")
      .selectAll("circle")
        .append("text")
          .text(d=>d.content)
      .data(data)
      
      .join("circle")
        
        .attr("class", "node")
        .attr("r", d => size(d.count))
        .attr("cx", (width-300) / 2)
        .attr("cy", (height + margin.top + margin.bottom-200) / 2)
        .style("fill", d => color(d.emo))
        .style("fill-opacity", 1)
        .attr("stroke", "none")
        .attr("opacity", 1)
        .on("mouseover", mouseover) // What to do when hovered
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)
        .on("click",mousemoveMain)


    // Features of the forces applied to the nodes:
    const simulation = d3.forceSimulation()
        .force("center", d3.forceCenter().x((width-300) / 2).y((height + margin.top + margin.bottom-200) / 2)) // Attraction to the center of the svg area
        .force("charge", d3.forceManyBody().strength(.1)) // Nodes are attracted one each other of value is > 0
        .force("collide", d3.forceCollide().strength(.2).radius(function(d){ return (size(d.count)+10) }).iterations(1)) // Force that avoids circle overlapping

    // Apply these forces to the nodes and update their positions.
    // Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
    simulation
        .nodes(data)
        .on("tick", function(d){
          node
              .attr("cx", d => d.x)
              .attr("cy", d => d.y)
        });
    d3.select("#mySlider").style("theme","#38E0E6")
    d3.select("#mySlider").on("change", function(d){
      newFile = this.value
       //新数据集
      data = dataset.filter(function(d){return d.label == newFile})
      //data = data.filter(function(d){return d.count>2})
      //更新气泡
      svg2.selectAll("circle")
        .data(data)
        .join("circle")
          .attr("class","node")
          .attr("r", d => size(d.count))
          .style("fill", d => color(d.emo))
          .attr("cx", (width-300) / 2)
          .attr("cy", (height + margin.top + margin.bottom-200) / 2)
      d3.forceSimulation()
        .force("center", d3.forceCenter().x((width-300) / 2).y((height + margin.top + margin.bottom-200) / 2)) // Attraction to the center of the svg area
        .force("charge", d3.forceManyBody().strength(.1)) // Nodes are attracted one each other of value is > 0
        .force("collide", d3.forceCollide().strength(.2).radius(function(d){ return (size(d.count)+10) }).iterations(1)) // Force that avoids circle overlapping
        .nodes(data)
        .on("tick", function(d){
          node
              .attr("cx", d => d.x)
              .attr("cy", d => d.y)
        })
    })
  })
  

  


  //玫瑰图
  d3.csv("./emo.csv").then( function(data) {
    // Scales
    const x = d3.scaleBand()
        .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle
        .align(0)                  // This does nothing
        .domain(data.map(d => d.label)); // The domain of the X axis is the list of states.
    const y = d3.scaleRadial()
        .range([innerRadius+30, outerRadius+60])   // Domain will be define later.
        .domain([0, 40]); // Domain of Y is from 0 to the max seen in the data
  
    const mouseover = function(event, d) {
      d3.select(this)
        .style("stroke", "white")
        .style("stroke-width", 1.5)
        .style("opacity", 1)
    }
    const mousemove = function(event, d) {

    }
    const mouseleave = function(event, d) {
      d3.select(this)
        .style("stroke", "none")
        .style("opacity", 0.8)

    }
    const emotion = d3.scaleOrdinal()
        .domain([0,1,2,3,4,5])
        .range(["厌恶","愤怒","伤心","害怕","惊讶","愉悦"])
    // Color palette for continents?
    const color = d3.scaleOrdinal()
      .domain([0,1,2,3,4,5])
      .range(["#00F0FF"	,"#00787F","#00A1AB","#00BAC5","#AEFFA1","#FFE974"]);
    // Add the bars
    svg1.append("g")
      .selectAll("path")
      .data(data)
      .join("path")
        .style("opacity", 0.8)
        .on("mouseover", mouseover) // What to do when hovered
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)
        .attr("fill", d=>color(d.label))
        .attr("d", d3.arc()     // imagine your doing a part of a donut plot
            .innerRadius(innerRadius)
            .outerRadius(d => y(d['emo']))
            .startAngle(d => x(d.label))
            .endAngle(d => x(d.label) + x.bandwidth())
            .padAngle(0.01)
            .padRadius(innerRadius))
  
    // Add the labels
    svg1.append("g")
        .selectAll("g")
        .data(data)
        .join("g")
          .attr("text-anchor", function(d) { return (x(d.label) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "end" : "start"; })
          .attr("transform", function(d) { return "rotate(" + ((x(d.label) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")"+"translate(" + (y(d['emo'])+10) + ",0)"; })
        .append("text")
          .text(function(d){return(emotion(d.label))})
          .attr("transform", function(d) { return (x(d.label) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "rotate(180)" : "rotate(0)"; })
          .style("font-size", "30px")
          .attr("fill","white")
          .attr("alignment-baseline", "middle")
  })
</script>










<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>
<script>
  //河流图
// Parse the Data
d3.csv("./river.csv", function(data) {

  // List of groups = header of the csv files
  var keys = data.columns.slice(1)

  // Add X axis
  var x = d3.scaleLinear()
    .domain(d3.extent(data, function(d) { return d.time; }))
    .range([ 0, width+1000 ]);
  svg3.append("g")
    .attr("transform", "translate(0," + height*0.8 + ")")
    .call(d3.axisBottom(x).tickSize(-height*.7).tickValues([1, 3, 5, 7]))
    .select(".domain").remove()
  // Customization
  svg3.selectAll(".tick line").attr("stroke", "#b8b8b8")

  // Add X axis label:
  svg3.append("text")
      .attr("text-anchor", "end")
      .attr("x", width+1000)
      .attr("y", height-30 )
      .style("font-size","50px")
      .style("fill","white")

      .text("Time");

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([-2400, 1700])
    .range([ height, 0 ]);

  // color palette
  var color = d3.scaleOrdinal()
    .domain(keys)
    .range(["#00F0FF"	,"#00787F","#00A1AB","#00BAC5","#AEFFA1","#FFE974"]);

  //stack the data?
  var stackedData = d3.stack()
    .offset(d3.stackOffsetSilhouette)
    .keys(keys)
    (data)

  // create a tooltip
  var Tooltip = svg3
    .append("text")
    .attr("x", 0)
    .attr("y", 0)
    .style("opacity", 0)
    .style("font-size", 17)

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    Tooltip.style("opacity", 1)
    d3.selectAll(".myArea").style("opacity", .2)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = function(d,i) {
    
  }
  var mouseleave = function(d) {
    Tooltip.style("opacity", 0)
    d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")
   }

  // Area generator
  var area = d3.area()
    .x(function(d) { return x(d.data.time); })
    .y0(function(d) { return y(d[0]); })
    .y1(function(d) { return y(d[1]); })

  // Show the areas
  svg3
    .selectAll("mylayers")
    .data(stackedData)
    .enter()
    .append("path")
      .attr("class", "myArea")
      .style("fill", function(d) { return color(d.key); })
      .attr("d", area)
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave)

})
  </script>









  <script src="https://d3js.org/d3.v6.js"></script>

<script>
  //热度扩散图
  const KEYS = ["动画区","游戏区","知识区","科技区","运动区","生活区","美食区","鬼畜区"]
  svg6.append("div")
  d3.csv("./rightbot.csv").then( function(dataset) {
    data = dataset.filter(function(d){ return d.ctime == 0})
    // Add X axis
    const x = d3.scaleLinear()
      .domain([-20, 700])
      .range([ 0, width-500 ]);
    svg6.append("g")
      .attr("transform", `translate(0, ${height})`)
      .call(d3.axisBottom(x));

    // Add a scale for bubble size
    const z = d3.scaleLinear()
      .domain([1, 160])
      .range([ 4, 50]);

    // Add a scale for bubble color
    const myColor = d3.scaleOrdinal()
      .domain([0,1,2,3,4,5,6,7])
      .range(d3.schemeSet2);

    // -1- Create a tooltip div that is hidden by default:
    const tooltip = d3.select("#my_dataviz6")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "#20B2AA")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "10px")
      .style("padding", "5px")

    // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
    const showTooltip = function(event, d) {
      tooltip
        .style("opacity", 1)
      d3.select(this)
        .style("stroke", "white")
        .style("stroke-width", 1.5)
        .style("opacity", 1)
    }
    const moveTooltip = function(event, d) {
      tooltip
        .html(AREA(d.label))
        .style("font-size","30px")
        .style("color","white")
        .style("left", (event.x-3680) + "px")
        .style("top", (event.y-1860) + "px")
        .style("position","absolute")
    }
    const hideTooltip = function(event, d) {
      tooltip
        .style("opacity", 0)
      d3.select(this)
        .style("stroke", "none")
        .style("opacity", 0.8)
  }

  const AREA = d3.scaleOrdinal()
  .domain([0,1,2,3,4,5,6,7])
  .range(["动画区","游戏区","知识区","科技区","运动区","生活区","美食区","鬼畜区"])

  
  // Add dots
  svg6.append('g')
    .selectAll("dot")
    .data(data)
    .join("circle")
      .attr("class", "bubbles")
      .attr("cx", d => x(d.pos))
      .attr("cy", 150)
      .attr("r", d => z(d.count))
      .style("fill", d => myColor(d.label))

    // -3- Trigger the functions
    .on("mouseover", showTooltip )
    .on("mousemove", moveTooltip )
    .on("mouseleave", hideTooltip )

    d3.select("#REDU").on("change", function(d){
      newFile = this.value
      //svg6.select("g").selectAll("bubbles").remove()
       //新数据集
      data = dataset.filter(function(d){return d.ctime == newFile})
      //更新画面
      
      svg6.selectAll("circle")
        .data(data)
        .join("circle")
          .attr("class", "bubbles")
          .attr("cx",d=>x(d.pos))
          .attr("cy",150)
          .attr("r",d=>z(d.count))
          .style("fill",d=>myColor(d.label))
        .on("mouseover", showTooltip )
        .on("mousemove", moveTooltip )
        .on("mouseleave", hideTooltip )
      //console.log(1)
      
    })
    })
  </script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script>
    // select the svg area
    var Svg = d3.select("#my_dataviz9")

    // create a list of keys
    var keys = ["动画区","游戏区","知识区","科技区","运动区","生活区","美食区","鬼畜区"]

    // Usually you have a color scale in your chart already
    var color = d3.scaleOrdinal()
      .domain(keys)
      .range(d3.schemeSet2);

    // Add one dot in the legend for each name.
    Svg.selectAll("mydots")
      .data(keys)
      .enter()
      .append("circle")
        .attr("cy", 20)
        .attr("cx", function(d,i){ return  30+i*80}) // 100 is where the first dot appears. 25 is the distance between dots
        .attr("r", 7)
        .style("fill", function(d){ return color(d)})

    // Add one dot in the legend for each name.
    Svg.selectAll("mylabels")
      .data(keys)
      .enter()
      .append("text")
        .attr("y", 50)
        .attr("x", function(d,i){ return  i*80}) // 100 is where the first dot appears. 25 is the distance between dots
        .style("fill", function(d){ return color(d)})
        .text(function(d){ return d})
        .style("font-size","20px")
        .attr("text-anchor", "left")
        .style("alignment-baseline", "middle")
  </script>

  <script src="https://d3js.org/d3.v4.js"></script>
  <script>
  
  var svg4 = d3.select("#my_dataviz4")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
    .append("svg")
      .attr("width", width + margin.left + margin.right-400)
      .attr("height", height + margin.top + margin.bottom-100)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

  

  //折线图

  //Read the data
  d3.csv("./line.csv",
    
    // When reading the csv, I must format variables:
    function(d){
      return { ctime : d3.timeParse("%Y-%m-%d")(d.ctime), count : d.count }
    },
    
    // Now I can use this dataset:
    function(data) {
      height1 = height-250
      // Add X axis --> it is a date format
      var x = d3.scaleTime()
        .domain(d3.extent(data, function(d) { return d.ctime; }))
        .range([ 0, width-450 ]);
      xAxis = svg4.append("g")
        .attr("transform", "translate(0," + height1 + ")")
        //.style("stroke","white")
        .style("fill","white")
        //.style("font-size","13px")
        .call(d3.axisBottom(x))
        .selectAll("text")
          .attr("transform", "translate(-10,10)rotate(-45)")
          .style("text-anchor", "end")
          .style("font-size", 20)
          .style("fill", "#69a3b2");

      // Add Y axis
      var y = d3.scaleLinear()
        .domain([1, d3.max(data, function(d) { return +d.count; })])
        .range([ height1, 0 ]);
      yAxis = svg4.append("g")
        .style("fill","white")
        .call(d3.axisLeft(y))
        .selectAll("text")
          .attr("transform", "translate(-10,10)rotate(-45)")
          .style("text-anchor", "end")
          .style("font-size", 20)
          .style("fill", "#69a3b2");

      // Add a clipPath: everything out of this area won't be drawn.
      var clip = svg4.append("defs").append("svg:clipPath")
          .attr("id", "clip")
          .append("svg:rect")
          .attr("width", width )
          .attr("height", height )
          .attr("x", 0)
          .attr("y", 0);

      // Add brushing
      var brush = d3.brushX()                   // Add the brush feature using the d3.brush function
          .extent( [ [0,0], [width-450,height1] ] )  // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area
          .on("end", updateChart)               // Each time the brush selection changes, trigger the 'updateChart' function

      // Create the line variable: where both the line and the brush take place
      var line = svg4.append('g')
        .attr("clip-path", "url(#clip)")

      // Add the line
      line.append("path")
        .datum(data)
        .attr("class", "line")  // I add the class line to be able to modify this line later on.
        .attr("fill", "none")
        .attr("stroke", "#38E0E6")
        .attr("stroke-width", 1.5)
        .attr("d", d3.line()
          .x(function(d) { return x(d.ctime) })
          .y(function(d) { return y(d.count) })
          )



      // A function that update the chart for given boundaries
      function updateChart() {

        // What are the selected boundaries?
        extent = d3.event.selection

        // If no selection, back to initial coordinate. Otherwise, update X axis domain
        if(!extent){
          if (!idleTimeout) return idleTimeout = setTimeout(idled, 350); // This allows to wait a little bit
          x.domain([ 0,5])
        }else{
          x.domain([ x.invert(extent[0]), x.invert(extent[1]) ])
          line.select(".brush").call(brush.move, null) // This remove the grey brush area as soon as the selection has been done
        }

        // Update axis and line position
        xAxis.transition().duration(1000).call(d3.axisBottom(x))
        line
            .select('.line')
            .transition()
            .duration(1000)
            .attr("d", d3.line()
              .x(function(d) { return x(d.ctime) })
              .y(function(d) { return y(d.count) })
            )
      }

      
      
  })





  //关系图？
  // Some constants controlling the graph appearance
  const PADDING_BUBBLE = 15 // distance between edge end and bubble
  const PADDING_LABEL = 30 // distance between edge end and engineer name
  const BUBBLE_SIZE_MIN = 4
  const BUBBLE_SIZE_MAX = 20

  var diameter = 560,
      radius = diameter / 2,
      innerRadius_relation = radius - 170; // between center and edge end

  // The 'cluster' function takes 1 argument as input. It also has methods (??) like cluster.separation(), cluster.size() and cluster.nodeSize()
  var cluster = d3.cluster()
      .size([360, innerRadius_relation]);

  var line = d3.radialLine()
      .curve(d3.curveBundle.beta(0.85))
      .radius(function (d) { return d.y; })
      .angle(function (d) { return d.x / 180 * Math.PI; });

  var svg5 = d3.select("#my_dataviz5")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
      .attr("width", diameter)
      .attr("height", diameter)
      .append("g")
      .attr("transform", "translate(" + radius + "," + radius + ")");

  var link = svg5.append("g").selectAll(".link"),
      label = svg5.append("g").selectAll(".label"),
      bubble = svg5.append("g").selectAll(".bubble");

  // Add a scale for bubble size
  var bubbleSizeScale = d3.scaleLinear()
      .domain([0, 100])
      .range([BUBBLE_SIZE_MIN, BUBBLE_SIZE_MAX]);

  // Scale for the bubble size
  d3.json("./data.json", function (error, hierarchicalData) {

      // If wanna see your data
      // console.log(hierarchicalData)

      // Reformat the data
      var root = packageHierarchy(hierarchicalData)
          //debugger;
          .sum(function (d) { console.log(d); return d.size; });
      // console.log(root)

      // Build an object that gives feature of each leaves
      cluster(root);
      leaves = root.leaves()

      // Leaves is an array of Objects. 1 item = one leaf. Provides x and y for leaf position in the svg. Also gives details about its parent.
      link = link
          .data(packageImports(leaves))
          .enter().append("path")
          .each(function (d) { d.source = d[0], d.target = d[d.length - 1]; })
          .attr("class", "link")
          .attr("d", line)
          .attr("fill", "none")
          .attr("stroke", "	#00FFFF")

      bubble = bubble
          .data(leaves)
          .enter().append("circle")
          .attr("class", "bubble")
          .attr("transform", function (d) { return "rotate(" + (d.x - 90) + ")translate(" + (d.y + PADDING_BUBBLE) + ",0)" })
          .attr('r', d => bubbleSizeScale(d.value))
          .attr('stroke', 'white')
          .attr('fill', '#000080')
          .style('opacity', .3)

      label = label
          .data(leaves)
          .enter().append("text")
          .attr("class", "label")
          .attr("dy", "0.31em")
          .attr("transform", function (d) { return "rotate(" + (d.x - 90) + ")translate(" + (d.y + PADDING_LABEL) + ",0)" + (d.x < 180 ? "" : "rotate(180)"); })
          .attr("text-anchor", function (d) { return d.x < 180 ? "start" : "end"; })
          .text(function (d) { return d.data.key; })
          .style("font-size","15px")
          .attr("fill","white");

  })

  // Lazily construct the package hierarchy from class names.
  function packageHierarchy(classes) {
      var map = {};

      function find(name, data) {
          var node = map[name], i;
          if (!node) {
              node = map[name] = data || { name: name, children: [] };
              if (name.length) {
                  node.parent = find(name.substring(0, i = name.lastIndexOf(".")));
                  node.parent.children.push(node);
                  node.key = name.substring(i + 1);
              }
          }
          return node;
      }

      classes.forEach(function (d) {
          find(d.name, d);
      });

      return d3.hierarchy(map[""]);
  }

  // Return a list of imports for the given array of nodes.
  function packageImports(nodes) {
      var map = {},
          imports = [];

      // Compute a map from name to node.
      nodes.forEach(function (d) {
          map[d.data.name] = d;
      });

      // For each import, construct a link from the source to target node.
      nodes.forEach(function (d) {
          if (d.data.imports) d.data.imports.forEach(function (i) {
              imports.push(map[d.data.name].path(map[i]));
          });
      });

      return imports;
  }




  //主图
  d3.csv("./tsne.csv", function (data) {

    var x = d3.scaleLinear()
        .domain([-10, 0])
        .range([0, width+900]);
    svg7.append("g")
        .attr("transform", "translate(0," + (height+200) + ")")
        .call(d3.axisBottom(x)).attr("opacity",0);


    var y = d3.scaleLinear()
        .domain([-15, 0])
        .range([height+200, 0]);
    svg7.append("g")
        .call(d3.axisLeft(y)).attr("opacity",0);

    var color = d3.scaleOrdinal()
        .domain([0,1,2,3,4,5])
        .range(["#00F0FF"	,"#00787F","#00A1AB","#00BAC5","#AEFFA1","#FFE974"])

    // create a tooltip

    var Tooltip = d3.select("#my_dataviz7")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "#20B2AA")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "10px")
      .style("padding", "5px")
    

    //.attr("fill","white")

    // Three function that change the tooltip when user hover / move / leave a cell

    var mouseover = function(d) {
    Tooltip.style("opacity", 1)
    //svg7.selectAll("circle" ).style("opacity", .2)
    d3.select(this)
      .style("stroke", "white")
      .style("opacity", 1)
    }
    var mousemove = function(event,d) {
      Tooltip
        .html( d.content)
        .style("font-size","40px")
        .style("color","white")
        .style("position","absolute")
        .style("left", event.x-1500 + "px")
        .style("top", event.y-350 + "px")
    }
    var mouseleave = function(d) {
    Tooltip.style("opacity", 0)
    d3.select(this)
      .style("stroke", "none")
      .style("opacity", .5)
    //svg7.selectAll("circle").style("opacity", .9).style("stroke", "none")
    }

    svg7.append('g')
        .selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
        .attr("class",function(d){return d.content})
        .attr("cx", function (d) { return x(d.Dimension_1); })
        .attr("cy", function (d) { return y(d.Dimension_2); })
        .attr("r", d=>(Math.sqrt(d.count)))
        .style("fill", d=>color(d.emo))
        .attr("opacity",0.9)
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)
  
  })



  //接口
  var button_flag = 0;
  var bvHao = 0;
  d3.select("button").on("click",function(){
    button_flag = 1
  })
  d3.select("#BV").on("input", function(d){
    if(button_flag==1){
      bvHao = this.value;
    }
  })

  </script>
  <script src="https://d3js.org/d3.v6.js"></script>
  <script>

    //以下均为标签

    const svg_l_bubble = d3.select("#label_bubble")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",600)
        .attr("height",100)
        .append("text")
          .text("视频词云")
          .attr("alignment-baseline", "middle")
          .attr("transform","translate("+190+","+50+")")
          .style("font-size","50px")
          .style("fill","white")
          .style("stroke","white")


    const svg_l_circular = d3.select("#label_circular")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",600)
        .attr("height",100)
        .append("text")
          .text("情感分布")
          .attr("alignment-baseline", "middle")
          .attr("transform","translate("+190+","+50+")")
          .style("font-size","50px") 
          .style("fill","white")
          .style("stroke","white") 


    const svg_l_stream = d3.select("#label_stream")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",2000)
        .attr("height",100)
        .append("text")
          .text("情绪变化")
          .attr("alignment-baseline", "middle")
          .attr("transform","translate("+870+","+50+")")
          .style("font-size","50px")    
          .style("fill","white")
          .style("stroke","white")


    const svg_l_line = d3.select("#label_line")
    .style("background-color", "#003644")
    .style("border", "solid")
    .style("border-width", "10px")
    .style("border-color", "#003644")
    .style("border-radius", "10px")
    .style("padding", "5px")
    .append("svg")
      .attr("width",600)
      .attr("height",100)
      .append("text")
        .text("热度曲线")
        .attr("alignment-baseline", "middle")
        .attr("transform","translate("+190+","+50+")")
        .style("font-size","50px") 
        .style("fill","white")
        .style("stroke","white")
        
        
    const svg_l_relation = d3.select("#label_relation")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",600)
        .attr("height",100)
        .append("text")
          .text("关联梗词")
          .attr("alignment-baseline", "middle")
          .attr("transform","translate("+190+","+50+")")
          .style("font-size","50px") 
          .style("fill","white")
          .style("stroke","white")
          //2，定义字体
          //@font-face定义
          //阿里巴巴普惠体(https://www.iconfont.cn/)
          .style("font-family","微软雅黑")


    const svg_l_kuosan = d3.select("#label_kuosan")
      .style("background-color", "#003644")
      .style("border", "solid")
      .style("border-width", "10px")
      .style("border-color", "#003644")
      .style("border-radius", "10px")
      .style("padding", "5px")
      .append("svg")
        .attr("width",600)
        .attr("height",100)
        .append("text")
          .text("热度扩散")
          .attr("alignment-baseline", "middle")
          .attr("transform","translate("+190+","+50+")")
          .style("font-size","50px") 
          .style("fill","white")
          .style("stroke","white")


    const svg_l_main = d3.select("#label_main")
          .style("background-color", "#003644")
          .style("border", "solid")
          .style("border-width", "10px")
          .style("border-color", "#003644")
          .style("border-radius", "10px")
          .style("padding", "5px")
          .append("svg")
            .attr("width",2000)
            .attr("height",100)
            .append("text")
              .text("热梗传播情况及发展趋势")
              .attr("alignment-baseline", "middle")
              .attr("transform","translate("+700+","+50+")")
              .style("font-size","50px")    
              .style("fill","white")
              .style("stroke","white")
    const svg_l_bv = d3.select("#label_bv")
          .style("background-color", "#003644")
          .style("border", "solid")
          .style("border-width", "10px")
          .style("border-color", "#003644")
          .style("border-radius", "10px")
          .style("padding", "5px")
          .append("svg")
            .attr("width",600)
            .attr("height",100)
            .append("text")
              .text("请输入BV号：")
              .attr("alignment-baseline", "middle")
              .attr("transform","translate("+150+","+50+")")
              .style("font-size","50px")    
              .style("fill","white")
              .style("stroke","white")  
    const svg_l_zong = d3.select("#label_zong")
    .style("background-color", "black")
    .style("border", "solid")
    .style("border-width", "10px")
    .style("border-color", "#38E0E6")
    .style("border-radius", "30px")
    .style("padding", "5px")
    .append("svg")
      .attr("width",600)
      .attr("height",100)
      .append("text")
        .text("总数据量")
        .attr("alignment-baseline", "middle")
        .attr("transform","translate("+190+","+50+")")
        .style("font-size","50px")    
        .style("fill","white")
        .style("stroke","white")             
    const svg_l_san = d3.select("#label_san")
    .style("background-color", "black")
    .style("border", "solid")
    .style("border-width", "10px")
    .style("border-color", "#38E0E6")
    .style("border-radius", "30px")
    .style("padding", "5px")
    .append("svg")
      .attr("width",600)
      .attr("height",100)
      .append("text")
        .text("近三天数据量")
        .attr("alignment-baseline", "middle")
        .attr("transform","translate("+150+","+50+")")
        .style("font-size","50px")    
        .style("fill","white")
        .style("stroke","white")    


  </script>
</body>
</head>